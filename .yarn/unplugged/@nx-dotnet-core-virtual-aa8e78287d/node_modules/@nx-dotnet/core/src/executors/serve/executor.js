"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
const path_1 = require("path");
const dotnet_1 = require("@nx-dotnet/dotnet");
const utils_1 = require("@nx-dotnet/utils");
let childProcess;
let projectDirectory;
function dotnetRunExecutor(options, context, dotnetClient = new dotnet_1.DotNetClient((0, dotnet_1.dotnetFactory)())) {
    const nxProjectConfiguration = (0, utils_1.getExecutedProjectConfiguration)(context);
    const cwd = (0, path_1.resolve)(devkit_1.workspaceRoot, nxProjectConfiguration.root);
    dotnetClient.cwd = cwd;
    return (0, utils_1.getProjectFileForNxProject)(nxProjectConfiguration).then((project) => runDotnetRun(dotnetClient, (0, path_1.resolve)(devkit_1.workspaceRoot, project), options));
}
exports.default = dotnetRunExecutor;
const runDotnetRun = (dotnetClient, project, options) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    const { watch } = options, commandLineOptions = tslib_1.__rest(options, ["watch"]);
    childProcess = dotnetClient.run(project, watch, commandLineOptions);
    yield (0, utils_1.handleChildProcessPassthrough)(childProcess);
    yield (0, utils_1.rimraf)(projectDirectory + '/bin');
    yield (0, utils_1.rimraf)(projectDirectory + '/obj');
    return { success: true };
});
//# sourceMappingURL=executor.js.map