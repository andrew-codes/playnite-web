"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const xmldoc_1 = require("xmldoc");
const utils_1 = require("@nx-dotnet/utils");
const generate_project_1 = require("../../../generators/utils/generate-project");
function update(host) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const projects = yield (0, utils_1.getNxDotnetProjects)(host);
        for (const [name, project] of projects.entries()) {
            const projectFilePath = yield (0, utils_1.getProjectFileForNxProject)(project);
            const buffer = host.read(projectFilePath);
            if (!buffer) {
                throw new Error(`Error reading file ${projectFilePath}`);
            }
            const xml = new xmldoc_1.XmlDocument(buffer.toString());
            if (!xml
                .childrenNamed('Target')
                .some((x) => x.attr['Name'] === 'CheckNxModuleBoundaries')) {
                (0, generate_project_1.addPrebuildMsbuildTask)(host, { projectName: name, projectRoot: project.root }, xml);
                host.write(projectFilePath, xml.toString());
            }
        }
    });
}
exports.default = update;
//# sourceMappingURL=migrate.js.map